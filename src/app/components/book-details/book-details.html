<div class="container py-4">
  <button class="btn btn-outline-secondary mb-4" (click)="onBack()">
    <i class="bi bi-arrow-left"></i> Volver al Catálogo
  </button>

  @if (loading) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3">Cargando detalles del libro...</p>
    </div>
  }

  @if (errorMessage && !loading) {
    <div class="alert alert-danger" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ errorMessage }}
      <div class="mt-2">
        <button class="btn btn-outline-danger btn-sm" (click)="onBack()">
          Volver al catálogo
        </button>
      </div>
    </div>
  }

  <!-- Detalles del libro -->
  @if (book && !loading && !errorMessage) {
    <div class="row">
      <div class="col-md-4 mb-4">
        <div class="card shadow">
          <img [src]="book.imageUrl"
               [alt]="book.title"
               class="card-img-top book-cover-img"
               style="max-height: 400px; object-fit: cover;">

          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="badge fs-6" [ngClass]="book.type === 'venta' ? 'bg-primary' : 'bg-success'">
                {{ book.type === 'venta' ? 'En Venta' : 'Donación' }}
              </span>

              @if (book.type === 'venta' && book.price) {
                <h3 class="text-success mb-0">${{ book.price.toLocaleString('es-ES') }}</h3>
              } @else {
                <h3 class="text-warning mb-0">GRATIS</h3>
              }
            </div>

            <div class="d-grid gap-2">
              <button class="btn btn-outline-success" (click)="onAddToFavorites()">
                <i class="bi bi-heart me-2"></i>Agregar a Favoritos
              </button>
              <button class="btn btn-success" (click)="onRequestBook()">
                <i class="bi bi-arrow-bar-right me-2"></i>Solicitar Libro
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card shadow">
          <div class="card-header bg-light">
            <h1 class="h3 mb-0">{{ book.title }}</h1>
            <p class="text-muted mb-0">por {{ book.author }}</p>
          </div>

          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-6">
                <p><strong>ISBN:</strong> {{ book.isbn }}</p>
                <p><strong>Publicación original:</strong>
                  {{ book.releaseDate | date:'dd/MM/yyyy' }}
                </p>
              </div>
              <div class="col-md-6">
                <p><strong>Condición:</strong>
                  <span class="badge ms-2" [ngClass]="getConditionClass(book.condition)">
                    {{ getConditionText(book.condition) }}
                  </span>
                </p>
                <p><strong>Ubicación:</strong>
                  <i class="bi bi-geo-alt ms-2"></i> {{ book.location }}
                </p>
              </div>
            </div>

            <div class="mb-4">
              <h5 class="text-primary">Descripción</h5>
              <p class="card-text">{{ book.description }}</p>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="card border-light">
                  <div class="card-body">
                    <h6 class="card-title text-muted">
                      <i class="bi bi-calendar3 me-2"></i>Fecha de publicación
                    </h6>
                    <p class="card-text">{{ book.createdAt | date:'dd/MM/yyyy' }}</p>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card border-light">
                  <div class="card-body">
                    <h6 class="card-title text-muted">
                      <i class="bi bi-check-circle me-2"></i>Estado
                    </h6>
                    <p class="card-text">
                      <span class="badge" [ngClass]="book.active ? 'bg-success' : 'bg-danger'">
                        {{ book.active ? 'Disponible' : 'No disponible' }}
                      </span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--Muestra una lista de reseñas de cada libro-->
    <app-review-crud [bookId]="book.id ?? null"></app-review-crud>


  }
</div>

