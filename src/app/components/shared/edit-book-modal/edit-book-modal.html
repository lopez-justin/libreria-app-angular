<div class="modal fade" [class.show]="isVisible" [style.display]="isVisible ? 'block' : 'none'" 
     tabindex="-1" role="dialog" aria-labelledby="editBookModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="editBookModalLabel">
          <i class="bi bi-pencil-square me-2"></i>Editar Libro
        </h5>
        <button type="button" class="btn-close" (click)="onClose()" aria-label="Close"></button>
      </div>

      <div class="modal-body" *ngIf="editedBook">
        <form (ngSubmit)="onSave()" #editForm="ngForm">
          
          <div class="row mb-3">
            <div class="col-md-8">
              <label for="title" class="form-label fw-bold">
                <i class="bi bi-book me-1"></i>Título del Libro *
              </label>
              <input type="text" 
                     class="form-control" 
                     id="title"
                     [(ngModel)]="editedBook.title" 
                     name="title"
                     required
                     placeholder="Ej: Cien años de soledad">
              <div class="form-text">Título completo del libro</div>
            </div>
            <div class="col-md-4">
              <label for="author" class="form-label fw-bold">
                <i class="bi bi-person me-1"></i>Autor *
              </label>
              <input type="text" 
                     class="form-control" 
                     id="author"
                     [(ngModel)]="editedBook.author" 
                     name="author"
                     required
                     placeholder="Ej: Gabriel García Márquez">
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="isbn" class="form-label fw-bold">
                <i class="bi bi-upc-scan me-1"></i>ISBN *
              </label>
              <input type="text" 
                     class="form-control" 
                     id="isbn"
                     [(ngModel)]="editedBook.isbn" 
                     name="isbn"
                     required
                     placeholder="Ej: 9788437604947">
              <div class="form-text">Código de 13 dígitos</div>
            </div>
            <div class="col-md-6">
              <label for="categoryId" class="form-label fw-bold">
                <i class="bi bi-tags me-1"></i>Categoría *
              </label>
              <select class="form-select" 
                      id="categoryId"
                      [(ngModel)]="editedBook.categoryId" 
                      name="categoryId"
                      required>
                <option value="" disabled>Seleccione una categoría</option>
                <option *ngFor="let cat of categories" [value]="cat.id">
                  {{ cat.name }}
                </option>
              </select>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">
                <i class="bi bi-currency-dollar me-1"></i>Tipo de Transacción *
              </label>
              <div class="btn-group w-100" role="group">
                <button type="button" 
                        class="btn" 
                        [class.btn-success]="editedBook.type === 'venta'"
                        [class.btn-outline-success]="editedBook.type !== 'venta'"
                        (click)="editedBook.type = 'venta'; onTypeChange()">
                  <i class="bi bi-cash-coin"></i> Venta
                </button>
                <button type="button" 
                        class="btn" 
                        [class.btn-warning]="editedBook.type === 'donacion'"
                        [class.btn-outline-warning]="editedBook.type !== 'donacion'"
                        (click)="editedBook.type = 'donacion'; onTypeChange()">
                  <i class="bi bi-gift"></i> Donación
                </button>
              </div>
            </div>
            <div class="col-md-6">
              <label for="condition" class="form-label fw-bold">
                <i class="bi bi-stars me-1"></i>Condición *
              </label>
              <select class="form-select" 
                      id="condition"
                      [(ngModel)]="editedBook.condition" 
                      name="condition"
                      required>
                <option value="" disabled>Seleccione condición</option>
                <option *ngFor="let cond of conditions" [value]="cond.value">
                  {{ cond.label }}
                </option>
              </select>
            </div>
          </div>

          <div class="row mb-3" *ngIf="editedBook.type === 'venta'">
            <div class="col-md-6">
              <label for="price" class="form-label fw-bold">
                <i class="bi bi-tag me-1"></i>Precio ($) *
              </label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" 
                       class="form-control" 
                       id="price"
                       [(ngModel)]="editedBook.price" 
                       name="price"
                       min="1"
                       step="0.01"
                       required
                       placeholder="0.00">
                <span class="input-group-text">.00</span>
              </div>
              <div class="form-text">Precio en dólares</div>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="location" class="form-label fw-bold">
                <i class="bi bi-geo-alt me-1"></i>Ubicación *
              </label>
              <input type="text" 
                     class="form-control" 
                     id="location"
                     [(ngModel)]="editedBook.location" 
                     name="location"
                     required
                     placeholder="Ej: Guayaquil, Ecuador">
            </div>
            <div class="col-md-6">
              <label for="releaseDate" class="form-label fw-bold">
                <i class="bi bi-calendar-date me-1"></i>Fecha Publicación Original *
              </label>
              <input type="date" 
                     class="form-control" 
                     id="releaseDate"
                     [(ngModel)]="editedBook.releaseDate" 
                     name="releaseDate"
                     required>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-12">
              <label for="description" class="form-label fw-bold">
                <i class="bi bi-chat-text me-1"></i>Descripción *
              </label>
              <textarea class="form-control" 
                        id="description"
                        [(ngModel)]="editedBook.description" 
                        name="description"
                        rows="4"
                        required
                        placeholder="Describe el libro, su estado, anotaciones especiales..."></textarea>
              <div class="form-text">Mínimo 50 caracteres</div>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-12">
              <label for="imageUrl" class="form-label fw-bold">
                <i class="bi bi-image me-1"></i>URL de la Imagen *
              </label>
              <input type="url" 
                     class="form-control" 
                     id="imageUrl"
                     [(ngModel)]="editedBook.imageUrl" 
                     name="imageUrl"
                     required
                     placeholder="https://ejemplo.com/imagen-libro.jpg">
              <div class="form-text">URL válida de una imagen del libro</div>
              
              <div class="mt-3 text-center" *ngIf="editedBook.imageUrl">
                <p class="text-muted mb-2"><small>Vista previa:</small></p>
                <img [src]="editedBook.imageUrl" 
                     alt="Vista previa" 
                     class="img-thumbnail"
                     style="max-height: 150px;">
              </div>
            </div>
          </div>

        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="onClose()">
          <i class="bi bi-x-circle me-2"></i>Cancelar
        </button>
        <button type="button" 
                class="btn btn-warning" 
                (click)="onSave()"
                [disabled]="!isValid()">
          <i class="bi bi-check-circle me-2"></i>
          {{ editedBook?.id ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
      
    </div>
  </div>
</div>

<div class="modal-backdrop fade" [class.show]="isVisible" [style.display]="isVisible ? 'block' : 'none'"></div>